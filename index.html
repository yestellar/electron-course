<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <div class="coin-contaier-template">
        <div class="content">
            <img class="image" width="32" height="32">
            <span class="symbol"></span>: $<span class="price"></span>
        </div>
        <div class="footer">
            <span class="date"></span>
            <a class="link" target="_blank">Open</a>
        </div>   
    </div>

    <script>
        const ipcRender = require('electron').ipcRenderer

        let isWindowOpen = false

        function setIPC() {
            ipcRender.on('get-coins--response', (e, coins) => {
                if (!isWindowOpen) ipcRender.send('show-window')

                clearData()
                mountData(coins)
            })
        }

        function clearData() {
            const coins = document.querySelectorAll('.coin-contaier')
            coins.forEach(coin => { coin.remove() })
        }

        function mountData(coins) {
            for (let coin of coins) {
                const coinContainerClone = document.querySelector('.coin-contaier-template').cloneNode(true)

                coinContainerClone.querySelector('.image').src = coin.image
                coinContainerClone.querySelector('.symbol').textContent = coin.symbol
                coinContainerClone.querySelector('.price').textContent = coin.current_price
                coinContainerClone.querySelector('.date').textContent = new Date(coin.last_updated).toLocaleString()
                coinContainerClone.querySelector('.link').href = 'https://www.coingecko.com/en/coins/' + coin.id

                coinContainerClone.classList.remove('coin-contaier-template')
                coinContainerClone.classList.add('coin-contaier')
                
                document.body.appendChild(coinContainerClone)
            }
        }

        setIPC()

        setInterval(() => {
            ipcRender.send('get-coins--request')
        }, 3000)
        ipcRender.send('get-coins--request')
    </script>
</body>
</html>